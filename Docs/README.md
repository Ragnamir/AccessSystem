# Документация Access System

Этот раздел описывает реализованный функционал, принятые архитектурные и типовые решения, а также инструкции по запуску и тестированию.

## Содержание

### Архитектура и дизайн
- **`Architecture.md`** — архитектура приложения, слои, технологический стек, решения по БД и миграциям, интеграционные тесты и окружение.
- **`Domain.md`** — доменная модель: value objects, модели данных, инварианты и правила валидации.
- **`TypeDesign-Decisions.md`** — решения по типовой архитектуре, использование value objects, контрактов, принципы организации кода.

### API и интеграция
- **`API.md`** — описание REST API endpoints (`/health`, `/ingest/event`), форматы запросов и ответов, коды статусов.
- **`openapi.yaml`** — OpenAPI 3.0 спецификация API для генерации документации и клиентов.

### База данных
- **`schema.md`** — схема базы данных: описание таблиц, индексов, связей между таблицами, текстовая диаграмма структуры БД.

### Безопасность
- **`crypto.md`** — криптография и проверка подписей: поддерживаемые алгоритмы (RSA, ECDSA), каноническая форма payload, формат подписанных сообщений, процесс верификации, обработка ошибок, рекомендации по безопасности.
- **`security.md`** — механизмы безопасности системы: анти-replay защита (проверка временного окна и одноразовых идентификаторов), параметры конфигурации, стратегия хранения, рекомендации по настройке.

### Контроль доступа
- **`access.md`** — матрица доступов и правила доступа: структура таблицы access_rules, примеры правил, логика проверки доступа, API сервиса, рекомендации по использованию.
- **`state.md`** — отслеживание состояния пользователя: инварианты состояния (зона OUT, вход/выход, переходы), оптимистичная блокировка, API сервиса, примеры использования.
- **`notifications.md`** — уведомления об отказах доступа: формат уведомлений, конфигурация, обработка ошибок, ретраи, интеграция и тестирование.

### Наблюдаемость
- **`observability.md`** — метрики (Micrometer/Prometheus), health-индикаторы и базовые SLA/алерты.

### Разработка и тестирование
- **`Environment.md`** — окружение разработки, профили приложения, конфигурация PostgreSQL, инструкции по локальному запуску.
- **`Testing.md`** — описание тестов, использование Testcontainers, инструкции по запуску тестов, требования к окружению.
- Дополнительно: модуль `event-generator` — отдельное приложение для генерации событий и smoke-тестов (`event-generator/README.md`).

## Локальный старт (Access System + Event Generator)

Предпосылки:
- Установлены Java 17+ и Maven
- Локальный PostgreSQL согласно `GeneralDocs/TestEnvironment/TestEnvironmentVariables`:
  - host: `localhost:5432`, user/password: `postgres/postgres`

Запуск (Windows PowerShell):

```bash
powershell -ExecutionPolicy Bypass -File .\scripts\start-local.ps1
```

Скрипт:
- поднимает Access System на `http://localhost:8080`, ждёт `GET /actuator/health`
- стартует Event Generator, указывая те же DB креды и `ingestUrl=http://localhost:8080/ingest/event`
- логи в `target/access-system.*.log` и `target/event-generator.*.log`

Параметры по умолчанию можно изменить, отредактировав `scripts/start-local.ps1` (например `ratePerSecond`).

## Навигация

Для быстрого старта рекомендуется начать с:
1. `Architecture.md` — общее понимание структуры системы
2. `API.md` — доступные endpoints
3. `Environment.md` — настройка окружения разработки
4. `Testing.md` — запуск тестов

Данная документация предназначена для следующих агентов и разработчиков как базовый ориентир по проекту.


