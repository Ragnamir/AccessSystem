# Access System

Система контроля физического доступа с серверным приложением, веб-интерфейсом и генератором событий. Репозиторий организован как мульти-модульный Maven-проект: корневой модуль отвечает за REST API и обработку событий, дополнительные модули обеспечивают визуализацию и генерацию тестовых сценариев.

## Структура репозитория

- `pom.xml` — корневой Maven-проект и главный сервис **Access System**.
- `src/main/java` — бизнес-логика приёма и обработки событий (`/ingest/event`), проверка подписей, правила доступа, ведение состояния пользователей.
- `web-ui/` — отдельный Spring Boot модуль с веб-интерфейсом (Thymeleaf) для просмотра зон, пользователей, событий и отказов.
- `event-generator/` — вспомогательное приложение, которое прогоняет сценарии проходов через пропускные пункты и дымовые тесты.
- `scripts/` — PowerShell-скрипты для локального запуска и остановки связки сервисов.
- `Docs/` и `GeneralDocs/` — архитектура, доменная модель, схема БД, решения по безопасности и прочие документы.
- `target/` — артефакты сборки и логи (игнорируются Git-ом).

## Основные модули

### Access System (корневой модуль)

- **Назначение:** обработка входящих событий прохода, проверка подписи пропускного пункта и токена пользователя, сверка правил доступа и текущего положения пользователя.
- **API:** `GET /health`, `POST /ingest/event` (см. `Docs/API.md` и `Docs/openapi.yaml`).
- **Стек:** Java 17, Spring Boot 3.3.x, Flyway, PostgreSQL, Testcontainers.
- **Хранение:** миграции в `src/main/resources/db/migration`, таблицы для пользователей, зон, правил доступа, событий, отказов и подписей.

### Web UI (`web-ui/`)

- **Назначение:** визуализация данных из БД. Показывает списки пропускных пунктов, пользователей с текущими зонами, событий и отказов.
- **Особенности:** Thymeleaf-шаблоны (`src/main/resources/templates`), пагинация, чтение только из безопасных представлений таблиц.
- **Запуск:** `cd web-ui && mvn spring-boot:run` (по умолчанию порт `8081`).

### Event Generator (`event-generator/`)

- **Назначение:** генерация синтетических событий и первичное наполнение БД (зоны, пользователи, правила, ключи).
- **Возможности:** сценарии валидных и ошибочных проходов, настраиваемая частота отправки, параметры подключения к БД и URL приёма событий.
- **Запуск:** `mvn -q -f event-generator/pom.xml spring-boot:run -Dspring-boot.run.arguments="--generator.ingestUrl=..."`.

## Быстрый старт

1. Установите Java 17+ и Maven 3.9+.
2. Поднимите PostgreSQL (по умолчанию `jdbc:postgresql://localhost:5432/postgres`, пользовател/пароль `postgres/postgres`).
3. Для одновременного запуска Access System и Event Generator выполните:
   ```powershell
   powershell -ExecutionPolicy Bypass -File .\scripts\start-local.ps1
   ```
   Скрипт поднимет основной сервис (`http://localhost:8080`), дождётся `GET /actuator/health`, затем запустит генератор событий. Логи пишутся в `target/access-system.*.log` и `target/event-generator.*.log`.

### Альтернативный ручной запуск

```powershell
mvn -q spring-boot:run                 # основной сервис (порт 8080)
mvn -q -f web-ui spring-boot:run       # веб-интерфейс (порт 8081)
mvn -q -f event-generator spring-boot:run `
  -Dspring-boot.run.arguments="--generator.ingestUrl=http://localhost:8080/ingest/event"
```

## Тестирование

- Юнит- и интеграционные тесты запускаются командой `mvn test` в каждом модуле.
- Корневой модуль и `web-ui` используют Testcontainers для изолированного PostgreSQL.
- Event Generator покрывает ключевые сценарии сборки полезных нагрузок.

## Дополнительные материалы

- `Docs/Architecture.md` — обзор архитектуры и слоёв.
- `Docs/Domain.md` — доменная модель и инварианты.
- `Docs/schema.md` — схема БД и миграции.
- `Docs/security.md`, `Docs/crypto.md` — детали проверки подписей и анти-replay.
- `Docs/Testing.md` — рекомендации по тестам.
- `GeneralDocs/Overview.txt` — высокоуровневое описание системы.

При необходимости расширяйте README новыми сценариями запуска, схемами или ссылками на wiki.

