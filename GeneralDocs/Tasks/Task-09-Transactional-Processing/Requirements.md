Название: Транзакционная обработка события и логирование успешных переходов

Требования

- Флоу: verify checkpoint -> verify userToken -> access check -> update user_state -> write events.
- Транзакция БД с атомарностью обновления user_state и записи события.

Тесты

- Интеграционные сценарии OK: корректное обновление zone и запись event.

Документация

- Диаграмма последовательностей в docs/flow.md (сценарий успешного прохода).

Готово, когда

- Сценарий выполняется атомарно; тесты зелёные; диаграмма обновлена.


